import{c as ne}from"./chunk-TVZMEJD5.js";import{$b as U,D as O,Db as Z,Eb as ee,Ha as d,Ib as te,Ka as l,Oa as s,Pa as r,Pb as oe,Q as K,Qa as L,Ra as h,Rb as ie,Sa as p,Ta as m,Tb as re,V as B,Va as a,Vb as D,Wa as R,Wb as y,Xb as E,Yb as $,Zb as T,_ as X,a as w,ac as F,b as S,bb as Y,bc as V,c as J,cb as g,cc as se,d as C,db as f,dc as q,ec as ae,g as A,ga as b,ha as x,ia as P,xa as c,ya as j}from"./chunk-J6TY4OG5.js";function de(i,n){if(i&1&&(s(0,"div",18),a(1," Welkom, "),s(2,"span",19),a(3),r(),a(4,"! "),r()),i&2){let e=n.ngIf;c(3),R(e.displayName||e.username)}}function pe(i,n){if(i&1){let e=h();s(0,"button",20),p("click",function(){b(e);let o=m();return x(o.router.navigate(["/add-quote"]))}),a(1," Quote Toevoegen "),r()}}function me(i,n){if(i&1){let e=h();s(0,"button",21),p("click",function(){b(e);let o=m();return x(o.router.navigate(["/pending-quotes"]))}),a(1," Wachtende Quotes "),r()}}function ge(i,n){if(i&1){let e=h();s(0,"button",22),p("click",function(){b(e);let o=m();return x(o.router.navigate(["/admin"]))}),a(1," Admin "),r()}}function fe(i,n){if(i&1){let e=h();s(0,"button",23),p("click",function(){b(e);let o=m();return x(o.logout())}),a(1," Uitloggen "),r()}}function _e(i,n){if(i&1){let e=h();s(0,"button",20),p("click",function(){b(e);let o=m();return x(o.router.navigate(["/login"]))}),a(1," Inloggen "),r()}}function ve(i,n){i&1&&(P(),s(0,"svg",24),L(1,"path",25),r())}function be(i,n){i&1&&(P(),s(0,"svg",24),L(1,"path",26),r())}function xe(i,n){if(i&1&&(s(0,"div",32),a(1," Welkom, "),s(2,"span",19),a(3),r(),a(4,"! "),r()),i&2){let e=n.ngIf;c(3),R(e.displayName||e.username)}}function he(i,n){if(i&1){let e=h();s(0,"button",30),p("click",function(){b(e);let o=m(2);return o.router.navigate(["/add-quote"]),x(o.mobileMenuOpen=!1)}),a(1," Quote Toevoegen "),r()}}function ye(i,n){if(i&1){let e=h();s(0,"button",30),p("click",function(){b(e);let o=m(2);return o.router.navigate(["/pending-quotes"]),x(o.mobileMenuOpen=!1)}),a(1," Wachtende Quotes "),r()}}function we(i,n){if(i&1){let e=h();s(0,"button",30),p("click",function(){b(e);let o=m(2);return o.router.navigate(["/admin"]),x(o.mobileMenuOpen=!1)}),a(1," Admin "),r()}}function Ce(i,n){if(i&1){let e=h();s(0,"button",30),p("click",function(){b(e);let o=m(2);return o.logout(),x(o.mobileMenuOpen=!1)}),a(1," Uitloggen "),r()}}function ke(i,n){if(i&1){let e=h();s(0,"button",30),p("click",function(){b(e);let o=m(2);return o.router.navigate(["/login"]),x(o.mobileMenuOpen=!1)}),a(1," Inloggen "),r()}}function Ie(i,n){if(i&1){let e=h();s(0,"div",27)(1,"div",28),d(2,xe,5,1,"div",29),g(3,"async"),s(4,"button",30),p("click",function(){b(e);let o=m();return o.router.navigate(["/quotes"]),x(o.mobileMenuOpen=!1)}),a(5," Quotes "),r(),d(6,he,2,0,"button",31),g(7,"async"),d(8,ye,2,0,"button",31),g(9,"async"),d(10,we,2,0,"button",31),g(11,"async"),d(12,Ce,2,0,"button",31),g(13,"async"),d(14,ke,2,0,"button",31),g(15,"async"),r()()}if(i&2){let e=m();c(2),l("ngIf",f(3,6,e.currentUser$)),c(4),l("ngIf",f(7,8,e.isLoggedIn$)),c(2),l("ngIf",f(9,10,e.isLoggedIn$)),c(2),l("ngIf",f(11,12,e.isAdmin$)),c(2),l("ngIf",f(13,14,e.isLoggedIn$)),c(2),l("ngIf",!f(15,16,e.isLoggedIn$))}}var ce=class i{constructor(n,e){this.authService=n;this.router=e;this.isLoggedIn$=this.authService.user$,this.isAdmin$=this.authService.isAdmin(),this.currentUser$=this.authService.getCurrentUserData()}isLoggedIn$;isAdmin$;currentUser$;mobileMenuOpen=!1;logout(){return C(this,null,function*(){try{yield this.authService.logout(),this.router.navigate(["/login"])}catch(n){console.error("Logout error:",n)}})}static \u0275fac=function(e){return new(e||i)(j(ae),j(ne))};static \u0275cmp=X({type:i,selectors:[["app-navbar"]],standalone:!0,features:[Y],decls:29,vars:21,consts:[[1,"bg-white","shadow"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","h-16"],[1,"flex"],[1,"flex-shrink-0","flex","items-center"],[1,"text-xl","font-bold","text-gray-900"],[1,"hidden","md:flex","items-center","space-x-4"],["class","text-sm text-gray-700 mr-4",4,"ngIf"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],["class","bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],[1,"md:hidden","flex","items-center"],["aria-expanded","false",1,"inline-flex","items-center","justify-center","p-2","rounded-md","text-gray-400","hover:text-gray-500","hover:bg-gray-100","focus:outline-none","focus:ring-2","focus:ring-inset","focus:ring-indigo-500",3,"click"],[1,"sr-only"],["class","block h-6 w-6","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",4,"ngIf"],["class","md:hidden",4,"ngIf"],[1,"text-sm","text-gray-700","mr-4"],[1,"font-semibold"],[1,"bg-indigo-600","hover:bg-indigo-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-gray-600","hover:bg-gray-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-gray-300","hover:bg-gray-400","text-gray-800","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",1,"block","h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"md:hidden"],[1,"px-2","pt-2","pb-3","space-y-1","sm:px-3","bg-white","border-t","border-gray-200"],["class","px-3 py-2 text-sm text-gray-700 border-b border-gray-200",4,"ngIf"],[1,"w-full","text-left","block","px-3","py-2","rounded-md","text-base","font-medium","text-gray-700","hover:text-gray-900","hover:bg-gray-50","transition-colors","duration-200",3,"click"],["class","w-full text-left block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors duration-200",3,"click",4,"ngIf"],[1,"px-3","py-2","text-sm","text-gray-700","border-b","border-gray-200"]],template:function(e,t){e&1&&(s(0,"nav",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),a(6,"22 kkr mogolen quotes"),r()()(),s(7,"div",6),d(8,de,5,1,"div",7),g(9,"async"),s(10,"button",8),p("click",function(){return t.router.navigate(["/quotes"])}),a(11," Quotes "),r(),d(12,pe,2,0,"button",9),g(13,"async"),d(14,me,2,0,"button",10),g(15,"async"),d(16,ge,2,0,"button",11),g(17,"async"),d(18,fe,2,0,"button",12),g(19,"async"),d(20,_e,2,0,"button",9),g(21,"async"),r(),s(22,"div",13)(23,"button",14),p("click",function(){return t.mobileMenuOpen=!t.mobileMenuOpen}),s(24,"span",15),a(25,"Open main menu"),r(),d(26,ve,2,0,"svg",16)(27,be,2,0,"svg",16),r()()()(),d(28,Ie,16,18,"div",17),r()),e&2&&(c(8),l("ngIf",f(9,9,t.currentUser$)),c(4),l("ngIf",f(13,11,t.isLoggedIn$)),c(2),l("ngIf",f(15,13,t.isLoggedIn$)),c(2),l("ngIf",f(17,15,t.isAdmin$)),c(2),l("ngIf",f(19,17,t.isLoggedIn$)),c(2),l("ngIf",!f(21,19,t.isLoggedIn$)),c(6),l("ngIf",!t.mobileMenuOpen),c(),l("ngIf",t.mobileMenuOpen),c(),l("ngIf",t.mobileMenuOpen))},dependencies:[te,Z,ee],encapsulation:2})};var ue=class i{constructor(n,e){this.firestore=n;this.auth=e;this.user$=ie(this.auth)}user$;convertTimestamps(n){let e=w({},n);return e.createdAt&&typeof e.createdAt.toDate=="function"&&(e.createdAt=e.createdAt.toDate()),e.date&&typeof e.date.toDate=="function"&&(e.date=e.date.toDate()),e.votes&&Array.isArray(e.votes)&&(e.votes=e.votes.map(t=>S(w({},t),{timestamp:t.timestamp&&typeof t.timestamp.toDate=="function"?t.timestamp.toDate():t.timestamp}))),e}addQuote(n){return C(this,null,function*(){let e=yield this.user$.pipe(O(1)).toPromise();if(!e)throw new Error("User not authenticated");let t=w({},n);t.date||delete t.date;let o=S(w({},t),{createdBy:e.uid||"",createdAt:new Date,status:"pending",votes:[]});console.log("Adding quote to pending_quotes:",o),yield D(y(this.firestore,"pending_quotes"),o),console.log("Quote added successfully")})}getPendingQuotes(){let n=y(this.firestore,"pending_quotes"),e=V(n,F("createdAt","desc"));return new A(t=>U(e,_=>{let v=[];_.forEach(u=>{let I=this.convertTimestamps(u.data());v.push(w({id:u.id},I))}),t.next(v)}))}getApprovedQuotes(){let n=y(this.firestore,"quotes"),e=V(n,F("createdAt","desc"));return new A(t=>U(e,_=>{let v=[];_.forEach(u=>{let I=this.convertTimestamps(u.data());v.push(w({id:u.id},I))}),t.next(v)}))}voteOnQuote(n,e){return C(this,null,function*(){let t=yield this.user$.pipe(O(1)).toPromise();if(!t)throw new Error("User not authenticated");try{let o=yield T(V(y(this.firestore,"users"),q("__name__","==",t.uid)));if(!o.empty&&o.docs[0].data().role==="admin")throw new Error("Admins cannot vote on quotes")}catch(o){throw console.error("Error checking user role:",o),new Error("Unable to verify user permissions")}console.log("Voting on quote:",n,"with vote:",e,"by user:",t.uid);try{let o=$(this.firestore,"pending_quotes",n),_=yield T(V(y(this.firestore,"pending_quotes"),q("__name__","==",n)));if(_.empty)throw console.error("Quote not found:",n),new Error("Quote not found");let v=_.docs[0].data(),u=this.convertTimestamps(v);console.log("Current quote data:",u),u.votes||(u.votes=[]);let I=u.votes.findIndex(k=>k.userId===t.uid);I!==-1?(u.votes[I].vote=e,u.votes[I].timestamp=new Date,console.log("Updated existing vote")):(u.votes.push({userId:t.uid,vote:e,timestamp:new Date}),console.log("Added new vote"));let Q=yield this.getTotalUsers(),M=[];for(let k of u.votes)try{let N=yield T(V(y(this.firestore,"users"),q("__name__","==",k.userId)));N.empty||N.docs[0].data().role==="user"&&M.push(k)}catch(N){console.error("Error checking user role for vote:",N)}let W=M.filter(k=>k.vote==="yes").length,G=M.filter(k=>k.vote==="no").length,z=Q>0?W/Q*100:0,H=Q>0?G/Q*100:0;console.log("Vote stats (regular users only):",{yesVotes:W,noVotes:G,totalUsers:Q,approvalPercentage:z,rejectionPercentage:H}),z>=50?(console.log("Quote approved, moving to quotes collection"),yield D(y(this.firestore,"quotes"),S(w({},u),{status:"approved"})),yield E(o),console.log("Quote moved to approved and removed from pending")):H>=50?(console.log("Quote rejected, removing from pending"),yield E(o),console.log("Quote rejected and removed from pending")):(console.log("Updating votes in pending quote"),yield se(o,{votes:u.votes}),console.log("Votes updated successfully"))}catch(o){throw console.error("Error in voteOnQuote:",o),o}})}getTotalUsers(){return C(this,null,function*(){try{let n=y(this.firestore,"users"),t=(yield T(n)).docs.filter(o=>o.data().role==="user");return console.log("Total regular users (excluding admins):",t.length),t.length}catch(n){return console.error("Error getting total users:",n),1}})}getTotalUsersCount(){return C(this,null,function*(){return this.getTotalUsers()})}getUserById(n){return C(this,null,function*(){try{let e=yield T(V(y(this.firestore,"users"),q("__name__","==",n)));return e.empty?null:e.docs[0].data()}catch(e){return console.error("Error getting user by ID:",e),null}})}getAllUsers(){let n=y(this.firestore,"users");return new A(e=>U(n,o=>{let _=[];o.forEach(v=>{_.push(w({id:v.id},v.data()))}),e.next(_)}))}deleteQuote(n,e="quotes"){return C(this,null,function*(){try{let t=$(this.firestore,e,n);yield E(t),console.log(`Quote ${n} deleted from ${e}`)}catch(t){throw console.error("Error deleting quote:",t),t}})}updateQuote(n){return C(this,null,function*(){try{console.log("Updating quote:",n.id);let t=$(this.firestore,"quotes",n.id);yield E(t),console.log("Quote removed from approved quotes");let e=S(w({},n),{votes:[],status:"pending"}),{id:_}=e,v=J(e,["id"]);yield D(y(this.firestore,"pending_quotes"),v),console.log("Quote moved back to pending quotes")}catch(t){throw console.error("Error updating quote:",t),t}})}static \u0275fac=function(e){return new(e||i)(B(re),B(oe))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};export{ce as a,ue as b};
