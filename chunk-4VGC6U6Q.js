import{c as Z}from"./chunk-V5UMPPQC.js";import{$b as q,D as $,Db as K,Eb as X,Ha as p,Ib as Y,Ka as d,Oa as s,Pa as r,Pb as ee,Q as G,Qa as U,Ra as x,Rb as te,Sa as f,Ta as v,Tb as ne,V as D,Va as a,Vb as S,Wa as B,Wb as C,Xb as V,Yb as N,Zb as j,_ as H,a as y,ac as P,b as T,bb as J,bc as E,c as z,cb as l,cc as oe,d as w,db as m,dc as ie,ec as re,g as Q,ga as _,ha as b,ia as M,xa as c,ya as O}from"./chunk-WXRRZLAK.js";function ue(i,n){if(i&1&&(s(0,"div",17),a(1," Welkom, "),s(2,"span",18),a(3),r(),a(4,"! "),r()),i&2){let e=n.ngIf;c(3),B(e.displayName||e.username)}}function de(i,n){if(i&1){let e=x();s(0,"button",19),f("click",function(){_(e);let o=v();return b(o.router.navigate(["/add-quote"]))}),a(1," Quote Toevoegen "),r()}}function pe(i,n){if(i&1){let e=x();s(0,"button",20),f("click",function(){_(e);let o=v();return b(o.router.navigate(["/pending-quotes"]))}),a(1," Wachtende Quotes "),r()}}function le(i,n){if(i&1){let e=x();s(0,"button",21),f("click",function(){_(e);let o=v();return b(o.router.navigate(["/admin"]))}),a(1," Admin "),r()}}function me(i,n){if(i&1){let e=x();s(0,"button",22),f("click",function(){_(e);let o=v();return b(o.logout())}),a(1," Uitloggen "),r()}}function ge(i,n){if(i&1){let e=x();s(0,"button",19),f("click",function(){_(e);let o=v();return b(o.router.navigate(["/login"]))}),a(1," Inloggen "),r()}}function fe(i,n){i&1&&(M(),s(0,"svg",23),U(1,"path",24),r())}function ve(i,n){i&1&&(M(),s(0,"svg",23),U(1,"path",25),r())}function _e(i,n){if(i&1&&(s(0,"div",30),a(1," Welkom, "),s(2,"span",18),a(3),r(),a(4,"! "),r()),i&2){let e=n.ngIf;c(3),B(e.displayName||e.username)}}function be(i,n){if(i&1){let e=x();s(0,"button",31),f("click",function(){_(e);let o=v(2);return o.router.navigate(["/add-quote"]),b(o.mobileMenuOpen=!1)}),a(1," Quote Toevoegen "),r()}}function xe(i,n){if(i&1){let e=x();s(0,"button",31),f("click",function(){_(e);let o=v(2);return o.router.navigate(["/pending-quotes"]),b(o.mobileMenuOpen=!1)}),a(1," Wachtende Quotes "),r()}}function he(i,n){if(i&1){let e=x();s(0,"button",31),f("click",function(){_(e);let o=v(2);return o.router.navigate(["/admin"]),b(o.mobileMenuOpen=!1)}),a(1," Admin "),r()}}function ye(i,n){if(i&1){let e=x();s(0,"button",31),f("click",function(){_(e);let o=v(2);return o.logout(),b(o.mobileMenuOpen=!1)}),a(1," Uitloggen "),r()}}function we(i,n){if(i&1){let e=x();s(0,"button",31),f("click",function(){_(e);let o=v(2);return o.router.navigate(["/login"]),b(o.mobileMenuOpen=!1)}),a(1," Inloggen "),r()}}function Ce(i,n){if(i&1&&(s(0,"div",26)(1,"div",27),p(2,_e,5,1,"div",28),l(3,"async"),p(4,be,2,0,"button",29),l(5,"async"),p(6,xe,2,0,"button",29),l(7,"async"),p(8,he,2,0,"button",29),l(9,"async"),p(10,ye,2,0,"button",29),l(11,"async"),p(12,we,2,0,"button",29),l(13,"async"),r()()),i&2){let e=v();c(2),d("ngIf",m(3,6,e.currentUser$)),c(2),d("ngIf",m(5,8,e.isLoggedIn$)),c(2),d("ngIf",m(7,10,e.isLoggedIn$)),c(2),d("ngIf",m(9,12,e.isAdmin$)),c(2),d("ngIf",m(11,14,e.isLoggedIn$)),c(2),d("ngIf",!m(13,16,e.isLoggedIn$))}}var se=class i{constructor(n,e){this.authService=n;this.router=e;this.isLoggedIn$=this.authService.user$,this.isAdmin$=this.authService.isAdmin(),this.currentUser$=this.authService.getCurrentUserData()}isLoggedIn$;isAdmin$;currentUser$;mobileMenuOpen=!1;logout(){return w(this,null,function*(){try{yield this.authService.logout(),this.router.navigate(["/login"])}catch(n){console.error("Logout error:",n)}})}static \u0275fac=function(e){return new(e||i)(O(re),O(Z))};static \u0275cmp=H({type:i,selectors:[["app-navbar"]],standalone:!0,features:[J],decls:27,vars:21,consts:[[1,"bg-white","shadow"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","h-16"],[1,"flex"],[1,"flex-shrink-0","flex","items-center"],[1,"text-xl","font-bold","text-gray-900"],[1,"hidden","md:flex","items-center","space-x-4"],["class","text-sm text-gray-700 mr-4",4,"ngIf"],["class","bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],["class","bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer",3,"click",4,"ngIf"],[1,"md:hidden","flex","items-center"],["aria-expanded","false",1,"inline-flex","items-center","justify-center","p-2","rounded-md","text-gray-400","hover:text-gray-500","hover:bg-gray-100","focus:outline-none","focus:ring-2","focus:ring-inset","focus:ring-indigo-500",3,"click"],[1,"sr-only"],["class","block h-6 w-6","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",4,"ngIf"],["class","md:hidden",4,"ngIf"],[1,"text-sm","text-gray-700","mr-4"],[1,"font-semibold"],[1,"bg-indigo-600","hover:bg-indigo-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-gray-600","hover:bg-gray-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],[1,"bg-gray-300","hover:bg-gray-400","text-gray-800","px-4","py-2","rounded-md","text-sm","font-medium","transition-colors","duration-200","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",1,"block","h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"md:hidden"],[1,"px-2","pt-2","pb-3","space-y-1","sm:px-3","bg-white","border-t","border-gray-200"],["class","px-3 py-2 text-sm text-gray-700 border-b border-gray-200",4,"ngIf"],["class","w-full text-left block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors duration-200",3,"click",4,"ngIf"],[1,"px-3","py-2","text-sm","text-gray-700","border-b","border-gray-200"],[1,"w-full","text-left","block","px-3","py-2","rounded-md","text-base","font-medium","text-gray-700","hover:text-gray-900","hover:bg-gray-50","transition-colors","duration-200",3,"click"]],template:function(e,t){e&1&&(s(0,"nav",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),a(6,"22 kkr mogolen quotes"),r()()(),s(7,"div",6),p(8,ue,5,1,"div",7),l(9,"async"),p(10,de,2,0,"button",8),l(11,"async"),p(12,pe,2,0,"button",9),l(13,"async"),p(14,le,2,0,"button",10),l(15,"async"),p(16,me,2,0,"button",11),l(17,"async"),p(18,ge,2,0,"button",8),l(19,"async"),r(),s(20,"div",12)(21,"button",13),f("click",function(){return t.mobileMenuOpen=!t.mobileMenuOpen}),s(22,"span",14),a(23,"Open main menu"),r(),p(24,fe,2,0,"svg",15)(25,ve,2,0,"svg",15),r()()()(),p(26,Ce,14,18,"div",16),r()),e&2&&(c(8),d("ngIf",m(9,9,t.currentUser$)),c(2),d("ngIf",m(11,11,t.isLoggedIn$)),c(2),d("ngIf",m(13,13,t.isLoggedIn$)),c(2),d("ngIf",m(15,15,t.isAdmin$)),c(2),d("ngIf",m(17,17,t.isLoggedIn$)),c(2),d("ngIf",!m(19,19,t.isLoggedIn$)),c(6),d("ngIf",!t.mobileMenuOpen),c(),d("ngIf",t.mobileMenuOpen),c(),d("ngIf",t.mobileMenuOpen))},dependencies:[Y,K,X],encapsulation:2})};var ae=class i{constructor(n,e){this.firestore=n;this.auth=e;this.user$=te(this.auth)}user$;convertTimestamps(n){let e=y({},n);return e.createdAt&&typeof e.createdAt.toDate=="function"&&(e.createdAt=e.createdAt.toDate()),e.date&&typeof e.date.toDate=="function"&&(e.date=e.date.toDate()),e.votes&&Array.isArray(e.votes)&&(e.votes=e.votes.map(t=>T(y({},t),{timestamp:t.timestamp&&typeof t.timestamp.toDate=="function"?t.timestamp.toDate():t.timestamp}))),e}addQuote(n){return w(this,null,function*(){let e=yield this.user$.pipe($(1)).toPromise();if(!e)throw new Error("User not authenticated");let t=y({},n);t.date||delete t.date;let o=T(y({},t),{createdBy:e.uid||"",createdAt:new Date,status:"pending",votes:[]});console.log("Adding quote to pending_quotes:",o),yield S(C(this.firestore,"pending_quotes"),o),console.log("Quote added successfully")})}getPendingQuotes(){let n=C(this.firestore,"pending_quotes"),e=E(n,P("createdAt","desc"));return new Q(t=>q(e,h=>{let g=[];h.forEach(u=>{let k=this.convertTimestamps(u.data());g.push(y({id:u.id},k))}),t.next(g)}))}getApprovedQuotes(){let n=C(this.firestore,"quotes"),e=E(n,P("createdAt","desc"));return new Q(t=>q(e,h=>{let g=[];h.forEach(u=>{let k=this.convertTimestamps(u.data());g.push(y({id:u.id},k))}),t.next(g)}))}voteOnQuote(n,e){return w(this,null,function*(){let t=yield this.user$.pipe($(1)).toPromise();if(!t)throw new Error("User not authenticated");console.log("Voting on quote:",n,"with vote:",e,"by user:",t.uid);try{let o=N(this.firestore,"pending_quotes",n),h=yield j(E(C(this.firestore,"pending_quotes"),ie("__name__","==",n)));if(h.empty)throw console.error("Quote not found:",n),new Error("Quote not found");let g=h.docs[0].data(),u=this.convertTimestamps(g);console.log("Current quote data:",u),u.votes||(u.votes=[]);let k=u.votes.findIndex(I=>I.userId===t.uid);k!==-1?(u.votes[k].vote=e,u.votes[k].timestamp=new Date,console.log("Updated existing vote")):(u.votes.push({userId:t.uid,vote:e,timestamp:new Date}),console.log("Added new vote"));let A=yield this.getTotalUsers(),L=u.votes.filter(I=>I.vote==="yes").length,R=u.votes.filter(I=>I.vote==="no").length,F=L/A*100,W=R/A*100;console.log("Vote stats:",{yesVotes:L,noVotes:R,totalUsers:A,approvalPercentage:F,rejectionPercentage:W}),F>=50?(console.log("Quote approved, moving to quotes collection"),yield S(C(this.firestore,"quotes"),T(y({},u),{status:"approved"})),yield V(o),console.log("Quote moved to approved and removed from pending")):W>=50?(console.log("Quote rejected, removing from pending"),yield V(o),console.log("Quote rejected and removed from pending")):(console.log("Updating votes in pending quote"),yield oe(o,{votes:u.votes}),console.log("Votes updated successfully"))}catch(o){throw console.error("Error in voteOnQuote:",o),o}})}getTotalUsers(){return w(this,null,function*(){try{let n=C(this.firestore,"users"),e=yield j(n);return console.log("Total users in database:",e.size),e.size}catch(n){return console.error("Error getting total users:",n),1}})}getTotalUsersCount(){return w(this,null,function*(){return this.getTotalUsers()})}getAllUsers(){let n=C(this.firestore,"users");return new Q(e=>q(n,o=>{let h=[];o.forEach(g=>{h.push(y({id:g.id},g.data()))}),e.next(h)}))}deleteQuote(n,e="quotes"){return w(this,null,function*(){try{let t=N(this.firestore,e,n);yield V(t),console.log(`Quote ${n} deleted from ${e}`)}catch(t){throw console.error("Error deleting quote:",t),t}})}updateQuote(n){return w(this,null,function*(){try{console.log("Updating quote:",n.id);let t=N(this.firestore,"quotes",n.id);yield V(t),console.log("Quote removed from approved quotes");let e=T(y({},n),{votes:[],status:"pending"}),{id:h}=e,g=z(e,["id"]);yield S(C(this.firestore,"pending_quotes"),g),console.log("Quote moved back to pending quotes")}catch(t){throw console.error("Error updating quote:",t),t}})}static \u0275fac=function(e){return new(e||i)(D(ne),D(ee))};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};export{se as a,ae as b};
